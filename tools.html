<doctype html>
<html>
  <head>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>

    <script type="text/javascript" src="../d3.v2.js"></script>
    <link rel="stylesheet" type="text/css" href="d3_style.css">

    <script>
      
      $(document).ready(function(){
        var data = [{name:'fps', value : 10},
              {name:'ms/f', value : 10},
              {name:'mem', value : 10},
              {name:'tex. mem', value : 10},
              {name:'mesh mem', value : 10},
              {name:'draw calls', value : 10}]
        
        console.log(data.length);
        
        var connection = new WebSocket('ws://localhost:8080', null);
        connection.onmessage = function (e) {
          //console.log('Server: ' + e.data);
          data = JSON.parse(e.data);
          // console.log(data);
          // console.log(data.length);

          chart.selectAll("rect")
            .data(data)
            .transition()
            .duration(500)
            .attr("width", function(d){return x(d.value)});          
  
          chart.selectAll("text")
            .data(data)
            .transition()
            .duration(500)
            .text(function(d){return String(d.value)})
            .attr("x", function(d){return x(d.value)});
        };

        
        var chart = d3.select("body")
           .append("svg:svg")
           .attr("class", "chart")
           .attr("width", 520)
           .attr("height", 30 * data.length + 20)
           // .append("g")        // this is a group tag
           // .attr("transform", "translate(10,15)"); // translate the group together
         
        var x = d3.scale.linear()
           .domain([0, 100])
           .range([0, 500]);
         
        var y = d3.scale.ordinal()
            .domain(data.map(function (d){ return d.name;}))
            .rangeBands([0, 30 * data.length]);


        chart.selectAll("line")
            .data(x.ticks(10))
            .enter().append("line")
            .attr("x1", x)
            .attr("x2", x)
            .attr("y1", 0)
            .attr("y2", 30 * data.length)
            .style("stroke", "#ccc");
           
        chart.selectAll("rect")
            .data(data)
            .enter().append("svg:rect")
            .attr("y", function(d,i){ return y(d.name);})
            .attr("width", function(d,i){ return x(d.value);})
            .attr("height", y.rangeBand());
        
        chart.selectAll("text")
            .data(data)
            .enter().append("svg:text")
            .attr("x", function(d,i){ return x(d.value);})
            .attr("y", function(d) { return y(d.name) + y.rangeBand() / 2; })
            .attr("dx", -3) // padding-right
            .attr("dy", ".35em") // vertical-align: middle
            .attr("text-anchor", "end") // text-align: right
            .text(function(d,i){return String(d.value)});

        chart.selectAll("text.yAxis")
            .data(data)
            .enter().append("svg:text")
          //  .attr("class", "labels")
            .attr("x", 4)
            .attr("y", function(d) { return y(d.name) + y.rangeBand() / 2; })
            .attr("dx", 0) // padding-right
            .attr("dy", ".35em") // vertical-align: middle
            //.attr("text-anchor", "end") // text-align: right
            .text(function(d,i){return String(d.name)});

    });

    </script>


  <script>
    document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')
  </script>
  
  </head>
  <body>

  </body>
</html>
