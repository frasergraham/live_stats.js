<!doctype html>

<html>
  <head>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="d3.v2.js"></script>
    <script type="text/javascript" src="live_charts.js"></script>
    <script type="text/javascript" src="charts/line.js"></script>
    <script type="text/javascript" src="charts/bar.js"></script>
    <script type="text/javascript" src="charts/pie.js"></script>
    <link rel="stylesheet" type="text/css" href="d3_style.css"/>

    <script>

      $(document).ready(function(){
          var test_line, test_bar, test_pie;

          // live_charts.default_chart_factory(function(connection, selector, data_group){
          //   connection.bar_chart()
          //     .data_source(data_group)
          //     .bind(selector);
          // });

          live_charts.default_width(200)
            .default_height(100)
            .default_selector("#test_3");

          var connection = live_charts.connect_to_data_source("ws://localhost:8080",
            function(data_groups){

              test_line = connection.line_chart()
                                    .width(800)
                                    .height(300)
                                    .stacked(true)
                                    .saved_points(100)
                                    .data_source("group_1")
                                    .bind("#test_1");

              test_bar = connection.bar_chart()
                                    .width(200)
                                    .height(300)
                                    .data_source("group_1")
                                    .bind("#test_2");

              test_pie = connection.pie_chart()
                                    .width(300)
                                    .height(300)
                                    .data_source("group_1")
                                    .bind("#test_2");


              var dragging_height = false;
              var start;
              var initial_height = test_line.height();

              $("#drag_height").mousedown(function(event){
                start = event.pageY;
                dragging_height = true;
                test_line.transition_delay(10);

                if (event && event.preventDefault) {
                   event.preventDefault();
                }
              });

              $("html").mouseup(function(event){
                dragging_height = false;
                test_line.transition_delay("auto");

                var dist = event.pageY - start;
                console.log(dist);
                if (dist > 10 || dist < -10){
                  test_line.height(Math.max(initial_height + dist, 50) );
                }
                $("#hline").css({"top": event.pageY + "px", "display": "none"});
                initial_height = test_line.height();
              });

              $("html").mousemove(function(event){
                if (dragging_height){

                  $("#hline").css({"top": event.pageY + "px", "display": "block"});
                }

                if (event && event.preventDefault) {
                   event.preventDefault();
                }
              });
        });

        $("#toggle_stacked").click(function(){
          test_line.stacked(!test_line.stacked());
        });

        $("#wider").click(function(){
          test_line.width(test_line.width() + 100 );
        });

        $("#narrower").click(function(){
          test_line.width(test_line.width() - 100);
        });

        $("#taller").click(function(){
          test_line.height(test_line.height() + 100 );
        });

        $("#shorter").click(function(){
          test_line.height(test_line.height() - 100);
        });




      });
    </script>

    <script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script>

  </head>
  <body>
    <div id="hline" class="line" style="position: absolute; top: 0px; bottom: 0px; width: 100%; height: 2px; pointer-events: none; "></div>

    <p id="test_1"></p>
    <div class="mover" id="drag_height">DRAG ME</div>
    <a href="#" id="toggle_stacked">TOGGLE STACKED</a>
    <a href="#" id="wider">WIDER</a>
    <a href="#" id="narrower">NARROWER</a>
    <a href="#" id="taller">TALLER</a>
    <a href="#" id="shorter">SHORTER</a>

    <p id="test_2"></p>
    <p id="test_3"></p>
  </body>
</html>
